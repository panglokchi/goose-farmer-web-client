<div data-bs-theme="dark" class="bg-body text-body vh-100" [ngStyle]="{'font-size': isMobile ? 'smaller' : '' }">
    <style>
        .custom-pills .active, .custom-pills .focus {
            background-color: rgba(135, 135, 135, 0.393) !important;
        }
    </style>

    <div class="d-flex h-100 overflow-hidden">
        <div [ngStyle]="{'min-width.em': narrowScreen ? '0' : '3.5' }" class="h-100" *ngIf="!narrowScreen">
            <div ngbNav #nav="ngbNav" [(activeId)]="active"
                class="nav-pills custom-pills flex-column bg-body-secondary z-1 h-100 position-absolute"
                orientation="horizontal"
                (mouseenter)="showPills()"
                (mouseleave)="hidePills()"
                >
                
                <button type="button" *ngIf="!narrowScreen" class="btn text-start m-1" [@show]="expand_pills ? 'shown' : 'hidden'" style="border: none">
                    <div [hidden]="expand_pills" class="p-1">🪿</div>
                    <div [hidden]="!expand_pills" class="text-truncate p-1">
                        🪿Goose Farmer
                    </div>
                </button>

                <ng-container ngbNavItem="missions">
                    <button ngbNavLink class="m-1 text-start" [@show]="expand_pills ? 'shown' : 'hidden'">
                        <div [hidden]="expand_pills">🏠</div>
                        <div [hidden]="!expand_pills" class="text-truncate">
                            🏠Home
                        </div>
                    </button>
                </ng-container>
                <ng-container ngbNavItem="birdList">
                    <button ngbNavLink class="m-1 text-start" [@show]="expand_pills ? 'shown' : 'hidden'">
                        <div [hidden]="expand_pills">🪺</div>
                        <div [hidden]="!expand_pills" class="text-truncate">
                            🪺Farm
                        </div>
                    </button>
                </ng-container>
                <ng-container ngbNavItem="summonBird">
                    <button ngbNavLink class="m-1 text-start" [@show]="expand_pills ? 'shown' : 'hidden'">
                        <div [hidden]="expand_pills">🪶</div>
                        <div [hidden]="!expand_pills"  class="text-truncate">
                            🪶Summon
                        </div>
                    </button>
                </ng-container>
            </div>
        </div>

        <div [ngStyle]="{'min-width.em': narrowScreen ? '0' : '3.5' }" class="h-100" *ngIf="narrowScreen">
            <div class="h-100 position-absolute d-flex z-1">
                <div ngbNav #nav="ngbNav" [(activeId)]="active"
                    class="nav-pills custom-pills d-flex flex-column justify-content-between bg-body-secondary h-100 position-absolute overflow-hidden pb-3"
                    orientation="horizontal"
                    (mouseenter)="showPills()"
                    (mouseleave)="hidePills()"
                    [@appear]="expand_pills ? 'shown' : 'hidden'"
                    >

                    <div class="pe-2">
                        <button type="button" class="btn text-start m-1" style="border: none">
                            <div class="text-truncate p-1" (click)="hidePills()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                                </svg>
                            </div>
                        </button>
    
                        <ng-container ngbNavItem="missions">
                            <button ngbNavLink class="m-1 text-start w-100">
                                <div [hidden]="expand_pills">🏠</div>
                                <div [hidden]="!expand_pills" class="text-truncate">
                                    🏠Home
                                </div>
                            </button>
                        </ng-container>
                        <ng-container ngbNavItem="birdList">
                            <button ngbNavLink class="m-1 text-start w-100">
                                <div [hidden]="expand_pills">🪺</div>
                                <div [hidden]="!expand_pills" class="text-truncate">
                                    🪺Farm
                                </div>
                            </button>
                        </ng-container>
                        <ng-container ngbNavItem="summonBird">
                            <button ngbNavLink class="m-1 text-start w-100">
                                <div [hidden]="expand_pills">🪶</div>
                                <div [hidden]="!expand_pills"  class="text-truncate">
                                    🪶Summon
                                </div>
                            </button>
                        </ng-container>
                    </div>




                    <div class="ms-auto py-1 container-fluid d-flex flex-column align-items-end">
                        <a class="m-0 py-2" (click)="signOut()" style="text-decoration:none">Log Out😢</a>
                        <a class="m-0 py-2" (click)="open(content)" *ngIf="player.is_guest == true" style="text-decoration:none">Register✏️</a>
                        <div class="m-0 py-2 text-secondary text-truncate">{{player.user.username}}👤</div>
                    </div>
                </div>
                <div class="h-100 vw-100 flex-fill" *ngIf="expand_pills" (click)="hidePills()" style="background-color: rgba(0,0,0,0.3)">
                </div>
            </div>
        </div>

        <div class="z-0 w-100">
            <div class="bg-body-tertiary container-fluid">
                <div class="d-flex align-items-center">
                    <div class="bg-info-subtle rounded me-2" *ngIf="narrowScreen" (click)="showPills()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
                        </svg>
                    </div>
                    <div class="my-1 py-2 flex-fill d-flex">
                        <!-- [@fade]="showAppleChange ? 'shown' : 'hidden'" -->
                        <div class="position-absolute z-1 w-100" style="top: 3em">
                            <span class="py-1 ps-1 pe-2 bg-info-subtle rounded-pill d-inline-flex justify-content-between me-2 z-1" [@fade]="showEggChange ? 'shown' : 'hidden'" style="max-width: 5em; width: 33%;">
                                <span>
                                    🥚
                                </span>
                                <span>
                                    {{eggChange}}
                                </span>
                            </span>
                            <span class="py-1 ps-1 pe-2 bg-info-subtle rounded-pill d-inline-flex justify-content-between me-2 z-1"  [@fade]="showFeatherChange ? 'shown' : 'hidden'" style="max-width: 5em; width: 33%; top: 3em">
                                <span>
                                    🪶
                                </span>
                                <span>
                                    {{featherChange}}
                                </span>
                            </span>
                            <span class="py-1 ps-1 pe-2 bg-info-subtle rounded-pill d-inline-flex justify-content-between me-2 z-1" [@fade]="showAppleChange ? 'shown' : 'hidden'" style="max-width: 5em; width: 33%; top: 3em">
                                <span>
                                    🍎
                                </span>
                                <span>
                                    {{appleChange}}
                                </span>
                            </span>
                        </div>
                        
                        <span class="py-1 ps-1 pe-2 bg-body rounded-pill d-inline-flex justify-content-between me-2" style="max-width: 5em; width: 33%">
                            <span>
                                🥚
                            </span>
                            <span>
                                {{player?.eggs}}
                            </span>
                        </span>

                        <span class="py-1 ps-1 pe-2 bg-body rounded-pill d-inline-flex justify-content-between me-2" style="max-width: 5em; width: 33%">
                            <span>
                                🪶
                            </span>
                            <span>
                                {{player?.summons}}
                            </span>
                        </span>

                        <span class="py-1 ps-1 pe-2 bg-body rounded-pill d-inline-flex justify-content-between" style="max-width: 5em; width: 33%">
                            <span>
                                🍎
                            </span>
                            <span>
                                {{player?.feed}}
                            </span>
                        </span>
                    </div>

                    <div ngbDropdown class="d-inline-block py-2" placement="bottom-end" *ngIf="!narrowScreen">
                        <button type="button" class="btn text-end" id="dropdownBasic1" ngbDropdownToggle>
                                {{player?.user?.username}} ⚙️
                        </button>
                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                            <button ngbDropdownItem (click)="signOut()">Log Out</button>
                            <button ngbDropdownItem (click)="open(content)" *ngIf="player.is_guest == true">Register Account</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex-fill position-relative" >
                <div style="height: 1.5em" >
                    <div class="position-absolute top-50 start-50 translate-middle text-truncate w-100">
                        <div class="container-fluid d-flex justify-content-between">
                            <div>
                                Current XP {{player.exp - player.last_level_exp}}
                            </div>
                            <div>
                                Lvl. {{player?.level}}
                            </div>
                            <div>
                                {{player.next_level_exp - player.last_level_exp}} to next level
                            </div>
                        </div>
                    </div>
                <ngb-progressbar class="bg-dark-subtle" type="primary" style="border-radius: 0px; height: 2em; margin-left: -1em" [animated]="true" [value]="(player.exp - player.last_level_exp)/(player.next_level_exp - player.last_level_exp)*100" />

                </div>
            </div>
            
            <ng-container *ngComponentOutlet="getContent(); inputs: inputs; injector: updatePlayerInfoInjector"/>
        </div>



    </div> 
</div>

<ng-template #content let-modal>
    <div data-bs-theme="dark">
        <div class="modal-header bg-body text-body border">
            <h4 class="modal-title" id="modal-basic-title">Register Account</h4>
            <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body bg-body text-body border-start border-end">
            <form [formGroup]="requestGuestVerificationForm" (submit)="submitGuestVerifyRequest()" id="requestGuestVerificationForm">
                <div class="mb-2">
                  <label class="form-label" for="email">Email</label>
                  <input class="form-control" type="email" id="email" formControlName="email" name="email" required>
                </div>

              </form>
        </div>
        <div class="modal-footer bg-body text-body border">
            <button type="button" type="submit" form="requestGuestVerificationForm" class="btn btn-outline-secondary">Confirm</button>
        </div>
    </div>
	
</ng-template>